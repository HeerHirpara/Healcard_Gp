{% extends "base.html" %}

{% block content %}

<div class="container mt-4">
  <div class="row justify-content-center">
    <div class="col-lg-8">

      <!-- Bill Header -->
      <div class="card shadow-lg mb-4" style="background:rgba(18, 27, 45, 0.8); border:1px solid rgba(34, 50, 74, 0.5); border-radius:14px; box-shadow:0 8px 32px rgba(0, 0, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.1); backdrop-filter:blur(10px); -webkit-backdrop-filter:blur(10px);">
        <div class="card-header text-center" style="background:rgba(15, 23, 42, 0.8); border-bottom:1px solid rgba(34, 50, 74, 0.5); box-shadow:inset 0 1px 0 rgba(255, 255, 255, 0.05); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);">
          <h2 class="text-info mb-0">
            <i class="fa-solid fa-file-invoice-dollar me-2"></i>Prescription Bill
          </h2>
        </div>
        <div class="card-body p-4">

          <!-- Patient & Doctor Info -->
          <div class="row mb-4">
            <div class="col-md-6">
              <h5 class="text-info mb-3">Patient Information</h5>
              <p class="text-light mb-1"><strong>Name:</strong> {{ bill.patient_name }}</p>
              <p class="text-light mb-1"><strong>Appointment Date:</strong> {{ bill.appointment_date }}</p>
            </div>
            <div class="col-md-6">
              <h5 class="text-info mb-3">Doctor Information</h5>
              <p class="text-light mb-1"><strong>Name:</strong> {{ bill.doctor_name }}</p>
              <p class="text-light mb-1"><strong>Specialty:</strong> {{ bill.doctor_specialty }}</p>
            </div>
          </div>

          <!-- Medicines Table -->
          <h5 class="text-info mb-3">Prescribed Medicines</h5>
          <div class="table-responsive">
            <table class="table table-dark table-striped" style="background:rgba(18, 27, 45, 0.9); border:1px solid rgba(34, 50, 74, 0.6); border-radius:10px; box-shadow:0 2px 8px rgba(0, 0, 0, 0.15), inset 0 1px 0 rgba(255, 255, 255, 0.03); backdrop-filter:blur(5px); -webkit-backdrop-filter:blur(5px);">
              <thead style="background:rgba(15, 23, 42, 0.8); border-bottom:1px solid rgba(34, 50, 74, 0.5);">
                <tr>
                  <th scope="col">Medicine Name</th>
                  <th scope="col" class="text-center">Tablets/Day</th>
                  <th scope="col" class="text-center">Duration (Days)</th>
                  <th scope="col" class="text-center">Quantity</th>
                  <th scope="col" class="text-center">Price (₹)</th>
                  <th scope="col" class="text-end">Total (₹)</th>
                </tr>
              </thead>
              <tbody>
                {% for medicine in bill.medicines %}
                <tr style="background:rgba(18, 27, 45, 0.7); border-bottom:1px solid rgba(34, 50, 74, 0.3);">
                  <td>{{ medicine.medicine_name }}</td>
                  <td class="text-center">{{ medicine.tablets }}</td>
                  <td class="text-center">{{ medicine.duration }}</td>
                  <td class="text-center">{{ medicine.tablets * medicine.duration }}</td>
                  <td class="text-center">{{ "%.2f"|format(medicine.price) }}</td>
                  <td class="text-end">{{ "%.2f"|format(medicine.total) }}</td>
                </tr>
                {% endfor %}
              </tbody>
            </table>
          </div>

          <!-- Bill Summary -->
          <div class="row mt-4">
            <div class="col-md-6 offset-md-6">
              <div class="card" style="background:rgba(15, 23, 42, 0.8); border:1px solid rgba(34, 50, 74, 0.5); box-shadow:0 4px 16px rgba(0, 0, 0, 0.2), inset 0 1px 0 rgba(255, 255, 255, 0.05); backdrop-filter:blur(8px); -webkit-backdrop-filter:blur(8px);">
                <div class="card-body">
                  <div class="d-flex justify-content-between mb-2">
                    <span class="text-light">Subtotal:</span>
                    <span class="text-light">₹{{ "%.2f"|format(bill.subtotal) }}</span>
                  </div>
                  <div class="d-flex justify-content-between mb-2">
                    <span class="text-light">GST ({{ bill.gst_rate }}%):</span>
                    <span class="text-light">₹{{ "%.2f"|format(bill.gst_amount) }}</span>
                  </div>
                  <hr style="border-color:#22324a;">
                  <div class="d-flex justify-content-between">
                    <strong class="text-info">Total Amount:</strong>
                    <strong class="text-info">₹{{ "%.2f"|format(bill.total_amount) }}</strong>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- Action Buttons -->
          <div class="text-center mt-4">
            <button onclick="window.print()" class="btn btn-info me-2">
              <i class="fa-solid fa-print me-2"></i>Print Bill
            </button>
            <a href="/patient_prescriptions" class="btn btn-secondary">
              <i class="fa-solid fa-arrow-left me-2"></i>Back to Prescriptions
            </a>
          </div>

        </div>
      </div>

    </div>
  </div>
</div>

<!-- Print Styles -->
<style>
@media print {
  body {
    background: white !important;
    color: black !important;
  }

  .card {
    background: white !important;
    border: 1px solid #ccc !important;
    box-shadow: none !important;
  }

  .table {
    color: black !important;
  }

  .text-info {
    color: #0dcaf0 !important;
  }

  .text-light {
    color: black !important;
  }

  .btn {
    display: none !important;
  }
}
.table-dark{
  --bs-table-bg:#121b2d;
  --bs-table-striped-bg:#151f33;   /* very close to background */
  --bs-table-color:#e6edf6;
  --bs-table-striped-color:#e6edf6;
  border-color:#22324a;
}

</style>

{% endblock %}
