{% extends 'base.html' %}

{% block content %}
<div class="card p-5 mx-auto mt-5"
     style="max-width:500px; background:#121b2d; color:#fff;
            border-radius:20px; box-shadow:0 15px 30px rgba(0,0,0,0.5);">

  <h3 class="text-center text-info mb-4">Welcome Back</h3>

  <form id="loginForm" method="POST" novalidate>

    <input type="email"
           name="email"
           class="form-control mb-1"
           placeholder="Email"
           required>
    <div class="invalid-feedback">Please enter a valid email address.</div>

    <input type="password"
           name="password"
           class="form-control mb-1"
           placeholder="Password"
           required>
    <div class="invalid-feedback">Password is required.</div>

    <button type="submit" class="btn btn-main w-100 mt-3">Login</button>

    <div class="text-center mt-3">
      <a href="{{ url_for('register') }}" class="text-info text-decoration-none">
        Create new account
      </a>
      <span class="text-secondary mx-1">|</span>
      <a href="{{ url_for('forgot_password') }}" class="text-secondary text-decoration-none">
        Forgot password?
      </a>
    </div>

  </form>
</div>

<!-- ================= SCRIPT ================= -->
<script>
const form = document.getElementById('loginForm');

// Clear validation messages on input - Show messages only for invalid fields
form.querySelectorAll('input').forEach(function(field) {
  field.addEventListener('input', function() {
    if (this.checkValidity()) {
      this.classList.remove('is-invalid');
    }
  });
});

form.addEventListener('submit', function(e) {
  let valid = true;
  form.querySelectorAll('input').forEach(function(field){
    if (!field.checkValidity()) {
      valid = false;
      field.classList.add('is-invalid');
    } else {
      field.classList.remove('is-invalid');
    }

    // Optional: extra email regex check
    if (field.type === 'email' && field.value) {
      const re = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
      if (!re.test(field.value)) {
        valid = false;
        field.classList.add('is-invalid');
      }
    }
  });

  if (!valid) e.preventDefault();
});
</script>

<!-- ================= STYLES ================= -->
<style>
/* INPUTS */
.form-control {
  background:#121b2d;
  color:#ffffff;
  border:1px solid #4dd0e1;
  border-radius:12px;
  padding:12px;
  transition:0.3s;
}

/* PLACEHOLDER */
.form-control::placeholder {
  color:#90a4ae;
  opacity:1;
}

/* FOCUS */
.form-control:focus {
  border-color:#00bcd4;
  box-shadow:0 0 6px rgba(77,208,225,0.4);
  background:#121b2d;
  color:#ffffff;
}

/* BUTTON */
.btn-main {
  background: linear-gradient(90deg,#4dd0e1,#00bcd4);
  color:#000;
  font-weight:600;
  border-radius:30px;
  padding:12px;
}

/* LINKS */
a.text-info:hover,
a.text-secondary:hover {
  text-decoration: underline;
}

/* INVALID FEEDBACK - Hidden by default, only shown for invalid fields */
.invalid-feedback {
  display: none !important;
  color: #ff6b6b;
  font-size: 0.85rem;
  margin-bottom: 8px;
  animation: fadeIn 0.3s ease forwards;
}

/* Show feedback ONLY when field has invalid class */
.is-invalid ~ .invalid-feedback,
.form-control.is-invalid + .invalid-feedback {
  display: block !important;
}

/* FADE IN ANIMATION */
@keyframes fadeIn {
  from { opacity:0; transform: translateY(-5px); }
  to { opacity:1; transform: translateY(0); }
}
</style>
{% endblock %}
