{% extends "base.html" %}
{% block content %}

<!-- ================= BACK BUTTON ================= -->
<div class="profile-back-btn">
  <a href="{{ back_url if back_url else 'javascript:history.back()' }}" title="Back to Previous Page" class="back-btn-icon">
    <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
      <path d="M15 18l-6-6 6-6"
            stroke="#ffffff"
            stroke-width="2.4"
            stroke-linecap="round"
            stroke-linejoin="round"/>
    </svg>
  </a>
</div>

<!-- ================= MAIN CARD ================= -->
<div class="card-pro mx-auto mt-4 wallet-card" style="max-width:720px; position:relative;">

  <h3 class="text-center text-info mb-4">Wallet</h3>

  <!-- ================= BALANCE ================= -->
  <div class="wallet-balance-box mb-4">
    <div class="balance-label">Available Balance</div>
    <div class="balance-amount">₹ {{ "%.2f"|format(balance) }}</div>
  </div>

  <!-- ================= INFO MESSAGE ================= -->
  <div class="info-message mb-4">
    <p class="text-center text-secondary small mb-0">
      <i class="fa-solid fa-info-circle me-2"></i>You can add funds anytime or go back to continue booking
    </p>
  </div>

  <!-- ================= ADD MONEY (Optional for patients) ================= -->
  {% if session.get('role') != 'doctor' %}
  <form method="POST" action="/add_money" class="add-money-box mb-4">

    <div class="row g-2 align-items-center mb-3">
      <div class="col-md-8 col-12">
        <input type="number"
               name="amount"
               class="form-control wallet-input"
               placeholder="Enter amount"
               min="1"
               required>
      </div>

      <div class="col-md-4 col-12">
        <button type="submit" class="btn btn-pro w-100">
          Add Money
        </button>
      </div>
    </div>

    <div class="payment-box">
      <h6 class="text-info mb-2">Payment Method</h6>

      <div class="form-check">
        <input class="form-check-input" type="radio" name="payment_method" id="wallet" value="Wallet" checked>
        <label class="form-check-label" for="wallet">Wallet (Instant add)</label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="radio" name="payment_method" id="upi" value="UPI">
        <label class="form-check-label" for="upi">UPI</label>
      </div>

      <div class="form-check">
        <input class="form-check-input" type="radio" name="payment_method" id="card" value="Card">
        <label class="form-check-label" for="card">Card</label>
      </div>
    </div>

  </form>
  {% endif %}

  <!-- ================= ACTION BUTTONS (Always Available) ================= -->
  <div class="action-buttons mb-4">
    <button class="btn btn-back w-100" onclick="goBack()">
      <i class="fa-solid fa-arrow-left me-2"></i>Back
    </button>
  </div>

  <!-- ================= TRANSACTION HISTORY ================= -->
  <h5 class="text-info mb-3">Transaction History</h5>

  {% if transactions %}
  <div class="wallet-history">

    {% for trans in transactions %}
    <div class="wallet-transaction">

      <div class="tx-left">
        <div class="tx-type">{{ trans.type|title }}</div>
        <div class="tx-date">{{ trans.date }}</div>
      </div>

      <div class="tx-amount {% if trans.type == 'credit' %}credit{% else %}debit{% endif %}">
        {% if trans.type == 'credit' %}+{% else %}-{% endif %}
        ₹ {{ "%.2f"|format(trans.amount) }}
      </div>

    </div>
    {% endfor %}

  </div>
  {% else %}
    <p class="text-center text-secondary mt-3">No transactions yet.</p>
  {% endif %}

</div>

<!-- ================= STYLES ================= -->
<style>

.wallet-card{
  background:#0f172a;
  border-radius:16px;
  padding:32px;
  border:1px solid rgba(77,208,225,.12);
  box-shadow:0 10px 25px rgba(0,0,0,.45);
}

/* back button */

.profile-back-btn{
  position:fixed;
  top:16px;
  left:16px;
  z-index:10;
}

.profile-back-btn a{
  width:40px;
  height:40px;
  border-radius:50%;
  background:#0b1220;
  display:flex;
  align-items:center;
  justify-content:center;
  box-shadow:0 6px 14px rgba(0,0,0,.45);
  transition:.2s;
  border:2px solid rgba(77, 208, 225, 0.3);
}

.profile-back-btn a:hover{
  transform:translateX(-3px);
  background:#111a30;
  border-color: rgba(77, 208, 225, 0.6);
  box-shadow: 0 6px 16px rgba(77, 208, 225, 0.2);
}

.back-btn-icon {
  animation: slideInLeft 0.5s ease forwards;
}

@keyframes slideInLeft {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

/* balance */

.wallet-balance-box{
  background:linear-gradient(145deg,#0b1220,#111c34);
  border-radius:14px;
  padding:20px;
  text-align:center;
  border:1px solid rgba(77,208,225,.18);
}

.balance-label{
  color:#94a3b8;
  font-size:14px;
}

.balance-amount{
  font-size:30px;
  font-weight:700;
  color:#22c55e;
  margin-top:4px;
}

/* add money */

.add-money-box{
  border:1px solid rgba(77,208,225,.12);
  border-radius:14px;
  padding:18px;
  background:#0b1220;
}

.payment-box{
  margin-top:8px;
}

/* inputs */

.wallet-input{
  background:#121b2d !important;
  color:#fff !important;
  border:1px solid #4dd0e1;
  border-radius:10px;
  padding:10px 12px;
}

.wallet-input:focus{
  border-color:#4dd0e1;
  box-shadow:0 0 0 .15rem rgba(77,208,225,.25);
}

/* radio */

.form-check-input{
  background:#121b2d;
  border:1px solid #4dd0e1;
}

.form-check-input:checked{
  background-color:#4dd0e1;
  border-color:#4dd0e1;
}

.form-check-label{
  color:#fff;
}

/* transactions */

.wallet-history{
  display:flex;
  flex-direction:column;
  gap:10px;
  margin-top:6px;
}

.wallet-transaction{
  background:#0b1220;
  border-radius:12px;
  padding:12px 14px;
  display:flex;
  justify-content:space-between;
  align-items:center;
  border:1px solid rgba(77,208,225,.14);
  transition:.2s;
}

.wallet-transaction:hover{
  background:#11182b;
}

/* text */

.tx-type{
  color:#e5e7eb;
  font-weight:600;
  font-size:15px;
}

.tx-date{
  font-size:12px;
  color:#94a3b8;
}

.tx-amount{
  font-weight:700;
  font-size:16px;
}

.tx-amount.credit{ color:#22c55e; }
.tx-amount.debit{ color:#ef4444; }

/* add money button */

.btn-pro{
  background:#4dd0e1;
  color:#083344;
  font-weight:600;
  border-radius:10px;
  padding:10px 12px;
  transition:.2s;
}

.btn-pro:hover{
  background:#26c6da;
  transform:translateY(-1px);
}

/* action buttons */

.action-buttons {
  display: flex;
  gap: 12px;
}

.btn-back {
  background: linear-gradient(90deg, #4dd0e1, #00bcd4);
  color: #000;
  border: none;
  font-weight: 600;
  border-radius: 10px;
  padding: 12px 20px;
  text-decoration: none;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: all 0.3s ease;
}

.btn-back:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 16px rgba(77, 208, 225, 0.3);
  background: linear-gradient(90deg, #00bcd4, #4dd0e1);
  color: #000;
  text-decoration: none;
}

/* info message */

.info-message {
  background: rgba(77, 208, 225, 0.08);
  border: 1px solid rgba(77, 208, 225, 0.2);
  border-radius: 10px;
  padding: 12px 16px;
  animation: slideDown 0.4s ease forwards;
}

@keyframes slideDown {
  from {
    opacity: 0;
    transform: translateY(-10px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}

</style>

<script>
function goBack() {
  const backUrl = "{{ back_url if back_url else '' }}";
  if (backUrl) {
    window.location.href = backUrl;
  } else {
    window.history.back();
  }
}
</script>

{% endblock %}
